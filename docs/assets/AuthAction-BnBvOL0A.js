import{t as F,u as V,a as G,g as $,r as t,j as e,f as W,B as g}from"./index-jp5HoJ_W.js";import{M as Y}from"./mail-Drcotsmk.js";import{L as R}from"./lock-Hk3J-vwX.js";import{E as q}from"./eye-off-COJATRo7.js";import{E as Z}from"./eye-9ytaC7Wn.js";import{C as K}from"./circle-check-CnFk8O1X.js";import{C as H}from"./circle-alert-BENP8VId.js";const re=()=>{const{verifyEmailCode:x,confirmResetPassword:h,user:c}=F(),{setPageLoading:I,setNavbarMode:j}=V(),n=G(),y=$(),[f,T]=t.useState(null),[N,A]=t.useState(null),[m,l]=t.useState("loading"),[w,o]=t.useState(null),[p,z]=t.useState(!1),k=t.useRef(!1),[a,L]=t.useState(""),[v,U]=t.useState(""),[S,E]=t.useState(!1),i=t.useMemo(()=>({length:a.length>=8&&a.length<=4096,uppercase:/[A-Z]/.test(a),lowercase:/[a-z]/.test(a),number:/[0-9]/.test(a),special:/[!@#$%^&*(),.?":{}|<>]/.test(a)}),[a]),O=t.useMemo(()=>Object.values(i).every(Boolean),[i]);t.useEffect(()=>{I(!1),j("hero");const s=(()=>{const P=new URLSearchParams(y.search);if(P.get("oobCode"))return P;const B=window.location.hash,C=new URLSearchParams(B.split("?")[1]||"");return C.get("oobCode")?C:new URLSearchParams(window.location.search)})(),d=s.get("mode"),b=s.get("oobCode");if(T(d),A(b),!d||!b){l("error"),o("Invalid action link. Please request a new one.");return}if(d==="verifyEmail"&&!k.current){if(c!=null&&c.emailVerified){l("success");return}k.current=!0,setTimeout(()=>M(b),500)}else d==="resetPassword"?l("loading"):d!=="verifyEmail"&&(l("error"),o("Unsupported action mode."));return()=>j("default")},[y]);const M=async r=>{try{await x(r),c&&await c.reload(),l("success");const s=setTimeout(()=>{c?n("/profile",{replace:!0}):n("/auth",{replace:!0})},4e3);return()=>clearTimeout(s)}catch(s){console.error("Email verification error:",s),l("error"),o((s==null?void 0:s.message)??"Failed to verify email. The link may be expired.")}},D=async r=>{if(r.preventDefault(),!!N){if(a!==v){o("Passwords do not match.");return}E(!0),o(null);try{await h(N,a),l("success"),setTimeout(()=>n("/auth"),3e3)}catch(s){o((s==null?void 0:s.message)??"Failed to reset password.")}finally{E(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-surface-dark flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[100%] h-[100%] bg-sky/30 rounded-full blur-[150px] animate-pulse-slow opacity-80"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[80%] h-[80%] bg-sky/15 rounded-full blur-[120px] animate-pulse-slow opacity-50"})]}),e.jsx("div",{className:"relative z-10 flex-grow flex items-center justify-center px-6 py-24",children:e.jsx("div",{className:"w-full max-w-[600px] bg-white/20 backdrop-blur-3xl rounded-[4rem] border-2 border-white/40 overflow-hidden relative",children:e.jsxs("div",{className:"p-10 sm:p-16 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 bg-white/30 rounded-full text-[10px] font-black uppercase tracking-[0.4em] text-white mb-10 border-2 border-white/40",children:[e.jsx(W,{size:14,className:"animate-spin-slow text-sky-light"}),e.jsx("span",{children:"SECURITY PORTAL"})]}),m==="loading"&&f==="verifyEmail"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-sky/20 rounded-full flex items-center justify-center text-sky mx-auto animate-pulse",children:e.jsx(Y,{size:40})}),e.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:"Verifying..."})]}),m==="loading"&&f==="resetPassword"&&e.jsxs("form",{className:"space-y-8 text-left",onSubmit:D,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:"New Password"}),e.jsx("p",{className:"text-[10px] text-white/40 font-black uppercase tracking-widest mt-2",children:"Enter your new secure password"})]}),w&&e.jsx("div",{className:"bg-red-500/20 p-4 rounded-2xl border border-red-500/30 text-red-500 text-[10px] font-black uppercase tracking-widest mb-6",children:w}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black uppercase tracking-widest text-white/30 ml-1",children:"Password"}),e.jsxs("div",{className:"relative group",children:[e.jsx(R,{className:"absolute left-5 top-1/2 -translate-y-1/2 text-white/20 group-focus-within:text-sky transition-colors",size:18}),e.jsx("input",{type:p?"text":"password",value:a,onChange:r=>L(r.target.value),className:"w-full bg-white/5 border border-white/20 rounded-2xl pl-14 pr-12 py-4 focus:border-sky/50 outline-none text-white font-black text-sm transition-all",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>z(!p),className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/20 hover:text-sky transition-colors",tabIndex:-1,children:p?e.jsx(q,{size:18}):e.jsx(Z,{size:18})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[9px] font-black uppercase tracking-widest text-white/30 ml-1",children:"Confirm"}),e.jsxs("div",{className:"relative group",children:[e.jsx(R,{className:"absolute left-5 top-1/2 -translate-y-1/2 text-white/20 group-focus-within:text-sky transition-colors",size:18}),e.jsx("input",{type:p?"text":"password",value:v,onChange:r=>U(r.target.value),className:"w-full bg-white/5 border border-white/20 rounded-2xl pl-14 pr-12 py-4 focus:border-sky/50 outline-none text-white font-black text-sm transition-all",placeholder:"••••••••"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4 px-1",children:[e.jsx(u,{met:i.length,label:"8-4096 characters"}),e.jsx(u,{met:i.uppercase,label:"Uppercase (A-Z)"}),e.jsx(u,{met:i.lowercase,label:"Lowercase (a-z)"}),e.jsx(u,{met:i.number,label:"Numeric (0-9)"}),e.jsx(u,{met:i.special,label:"Special char (!@#$)"})]}),e.jsx(g,{type:"submit",disabled:S||!O,className:"w-full h-16 mt-6 uppercase tracking-widest font-black",children:S?"UPDATING...":"RESET PASSWORD"})]}),m==="success"&&e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center text-green-500 mx-auto",children:e.jsx(K,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:"SUCCESS!"}),e.jsxs("p",{className:"text-[10px] text-white/40 font-black uppercase tracking-widest leading-relaxed",children:[f==="verifyEmail"?"YOUR EMAIL IS VERIFIED.":"PASSWORD RESET SUCCESSFUL.",e.jsx("br",{}),"REDIRECTING TO SIGN IN..."]}),e.jsx(g,{onClick:()=>n("/auth"),className:"w-full h-14 mt-4 uppercase tracking-widest font-black",children:"SIGN IN NOW"})]}),m==="error"&&e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center text-red-500 mx-auto",children:e.jsx(H,{size:48})}),e.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter",children:"ERROR"}),e.jsx("p",{className:"text-[10px] text-white/40 font-black uppercase tracking-widest leading-relaxed max-w-[250px] mx-auto",children:w}),e.jsx(g,{onClick:()=>n("/auth"),className:"w-full h-14 mt-4 uppercase tracking-widest font-black",children:"BACK TO SAFETY"})]})]})})})]})},u=({met:x,label:h})=>e.jsxs("div",{className:`flex items-center gap-1.5 transition-colors duration-300 ${x?"text-green-400":"text-white/20"}`,children:[e.jsx("div",{className:`w-1 h-1 rounded-full ${x?"bg-green-400":"bg-white/20"}`}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest leading-none text-left",children:h})]});export{re as default};
