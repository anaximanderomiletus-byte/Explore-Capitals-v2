import{r,h as U,a as Y,u as _,j as e,i as q,m as N,S as E,B,L as D,k as F,R as J,M as Q}from"./index-Cym281Ds.js";import{F as V}from"./FeedbackOverlay-DDNEFhE9.js";import{N as X}from"./network-BcSPcl6e.js";import{P as Z}from"./play-C-d609oR.js";import{A as C}from"./arrow-left-CtUYgdzg.js";import{T as ee}from"./timer-ox91tyWY.js";import{B as te}from"./building-2-CFVH7hWh.js";import"./sparkles-Ch2S72Eu.js";import"./circle-check-DYKGo5ug.js";import"./circle-x-bZVB848H.js";const R=t=>{const l=[...t];for(let a=l.length-1;a>0;a--){const m=Math.floor(Math.random()*(a+1));[l[a],l[m]]=[l[m],l[a]]}return l},se=t=>Array.from(t).map(l=>String.fromCharCode(l.codePointAt(0)-127397).toLowerCase()).join("");function he(){const[t,l]=r.useState("start"),[a,m]=r.useState(0),[x,S]=r.useState(60),[G,p]=r.useState([]),[z,u]=r.useState([]),[M,b]=r.useState(!1),[T,$]=r.useState(!1),[W,k]=r.useState(null),[K,v]=r.useState(0),{recordGameResult:I}=U(),P=Y(),{setPageLoading:A}=_();r.useEffect(()=>{A(!1)},[A]),r.useEffect(()=>{let i;return t==="playing"&&x>0?i=setInterval(()=>{S(d=>d-1)},1e3):x===0&&t==="playing"&&l("finished"),()=>clearInterval(i)},[t,x]);const O=i=>{const d=Math.floor(i/60),n=i%60;return`${d}:${String(n).padStart(2,"0")}`};r.useEffect(()=>{t==="finished"&&!T&&(I({gameId:"capital-connection",score:a,durationSeconds:60-x}),$(!0))},[t,T,I,a,x]);const g=r.useCallback(()=>{const i=R(Q).slice(0,6),d=[];i.forEach(n=>{d.push({id:`country-${n.id}`,label:n.name,type:"country",countryId:n.id,isMatched:!1,isSelected:!1,isWrong:!1,isCorrect:!1,flagCode:se(n.flag)}),d.push({id:`capital-${n.id}`,label:n.capital,type:"capital",countryId:n.id,isMatched:!1,isSelected:!1,isWrong:!1,isCorrect:!1})}),p(R(d)),u([]),b(!1)},[]),L=r.useCallback(()=>{m(0),S(60),$(!1),k(null),v(0),g(),l("playing")},[g]),H=r.useCallback(i=>{M||t!=="playing"||p(d=>{const n=d.find(o=>o.id===i);if(!n||n.isMatched||n.isSelected)return d;const w=d.map(o=>o.id===i?{...o,isSelected:!0}:o),y=[...z,i];if(y.length===2){b(!0);const o=w.find(c=>c.id===y[0]),h=w.find(c=>c.id===y[1]);if(o.countryId===h.countryId){m(s=>s+10),k("correct"),v(s=>s+1);const c=w.every(s=>s.isMatched||s.id===o.id||s.id===h.id);setTimeout(()=>{p(s=>s.map(f=>f.id===o.id||f.id===h.id?{...f,isCorrect:!0,isSelected:!1}:f))},50),setTimeout(()=>{p(s=>{const f=s.map(j=>j.id===o.id||j.id===h.id?{...j,isMatched:!0,isCorrect:!1}:j);return c&&setTimeout(g,400),b(!1),u([]),f})},450)}else k("incorrect"),v(c=>c+1),setTimeout(()=>{p(c=>c.map(s=>s.id===o.id||s.id===h.id?{...s,isWrong:!0}:s))},100),setTimeout(()=>{p(c=>c.map(s=>s.id===o.id||s.id===h.id?{...s,isSelected:!1,isWrong:!1}:s)),b(!1),u([])},800)}else u(y);return w})},[M,t,z,g]);return e.jsx("div",{className:"h-[100dvh] min-h-screen bg-surface-dark font-sans relative overflow-hidden",children:e.jsxs(q,{mode:"wait",children:[t==="start"&&e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},className:"h-full flex items-center justify-center px-4",children:[e.jsx(E,{title:"Capital Connection",description:"Connect countries to their capitals."}),e.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[100%] h-[100%] bg-sky/20 rounded-full blur-[150px] opacity-60 animate-pulse-slow"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[80%] h-[80%] bg-accent/10 rounded-full blur-[120px] opacity-40 animate-pulse-slow"})]}),e.jsxs("div",{className:"max-w-md w-full bg-white/10 backdrop-blur-3xl rounded-3xl p-8 text-center border-2 border-white/20 relative z-10 overflow-hidden",children:[e.jsx("div",{className:"w-20 h-20 bg-sky/20 rounded-2xl flex items-center justify-center mx-auto mb-8 text-sky border border-white/30 relative overflow-hidden",children:e.jsx(X,{size:36,className:"relative z-10"})}),e.jsx("h1",{className:"text-4xl font-display font-black text-white mb-2 uppercase tracking-tighter drop-shadow-md",children:"Capital Connection"}),e.jsx("p",{className:"text-white/40 text-[10px] mb-10 font-bold uppercase tracking-[0.2em] leading-relaxed",children:"Connect nations to their capitals."}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs(B,{onClick:L,size:"md",className:"w-full h-16 text-xl uppercase tracking-widest font-black",children:["PLAY ",e.jsx(Z,{size:20,fill:"currentColor"})]}),e.jsxs("button",{onClick:()=>P("/games"),className:"inline-flex items-center justify-center gap-2 text-white/30 hover:text-white transition-all font-black uppercase tracking-[0.3em] text-[10px] group relative z-20 pointer-events-auto",children:[e.jsx(C,{size:14,className:"group-hover:-translate-x-1 transition-transform"}),"Back to Games"]})]})]})]},"start"),t==="playing"&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,y:-20},className:"h-full flex flex-col px-3 md:px-4 pt-20 pb-4 md:pb-6 overflow-hidden",children:[e.jsx(E,{title:"Playing Capital Connection",description:"Match the country to its capital."}),e.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[10%] right-[10%] w-[60%] h-[60%] bg-sky/10 rounded-full blur-[100px]"}),e.jsx("div",{className:"absolute bottom-[10%] left-[10%] w-[50%] h-[50%] bg-accent/5 rounded-full blur-[80px]"})]}),e.jsxs("div",{className:"max-w-3xl mx-auto w-full flex shrink-0 items-center gap-2 mb-3 md:mb-4 bg-white/10 backdrop-blur-2xl p-2.5 md:p-3 rounded-2xl border border-white/20 z-10",children:[e.jsx(D,{to:"/games",className:"p-2 bg-white/10 hover:bg-white/20 rounded-xl text-white/60 hover:text-white transition-all duration-75 border border-white/10 group shadow-inner shrink-0",children:e.jsx(C,{size:18,className:"transition-transform"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center min-w-0",children:[e.jsx("h1",{className:"text-[9px] sm:text-[10px] font-black text-white uppercase tracking-[0.15em] sm:tracking-[0.3em] drop-shadow-md truncate max-w-full text-center",children:"Capital Connection"}),e.jsx("div",{className:"h-0.5 w-6 bg-sky/40 rounded-full mt-1"})]}),e.jsx("div",{className:"w-[42px] shrink-0"})]}),e.jsxs("div",{className:"flex-1 max-w-3xl mx-auto w-full flex flex-col overflow-hidden relative z-10 bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 sm:mb-4 relative z-20 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg bg-warning/15 border border-warning/30 shrink-0",children:[e.jsx(F,{size:14,className:"sm:w-4 sm:h-4 md:w-[18px] md:h-[18px] text-warning"}),e.jsx("span",{className:"font-display font-black text-base sm:text-lg md:text-xl text-white tabular-nums",children:a})]}),e.jsxs("div",{className:`flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg transition-all duration-300 shrink-0 ${x<10?"bg-red-500/15 border border-error":"bg-sky/20 border border-white/20"}`,children:[e.jsx("div",{className:x<10?"text-error":"text-sky-light",children:e.jsx(ee,{size:14,className:"sm:w-4 sm:h-4 md:w-[18px] md:h-[18px]"})}),e.jsx("span",{className:`font-display font-black text-base sm:text-lg md:text-xl tabular-nums min-w-[28px] sm:min-w-[32px] md:min-w-[36px] ${x<10?"text-error":"text-white"}`,children:O(x)})]})]}),e.jsx("div",{className:"flex-1 grid grid-cols-3 md:grid-cols-4 gap-3 md:gap-4 auto-rows-fr content-center relative z-10",children:G.map(i=>e.jsx(ae,{card:i,onClick:()=>H(i.id)},i.id))})]}),e.jsx(V,{type:W,triggerKey:K})]},"playing"),t==="finished"&&e.jsx(N.div,{initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"h-full flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white/10 backdrop-blur-3xl rounded-3xl p-10 text-center border-2 border-white/20 relative z-10 overflow-hidden",children:[e.jsx("div",{className:"w-20 h-20 bg-warning/20 rounded-full flex items-center justify-center mx-auto mb-8 text-warning border border-white/30 relative overflow-hidden",children:e.jsx(F,{size:36,className:"relative z-10"})}),e.jsx("h1",{className:"text-3xl font-display font-black text-white mb-1 uppercase tracking-tighter drop-shadow-md",children:"Finished"}),e.jsx("p",{className:"text-white/40 mb-6 text-[10px] font-bold uppercase tracking-[0.2em] drop-shadow-sm",children:"Final Score"}),e.jsx("div",{className:"text-7xl font-display font-black text-white mb-10 tabular-nums",children:a}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(B,{onClick:L,size:"md",className:"w-full h-16 text-xl uppercase tracking-widest font-black",children:"Play Again"}),e.jsxs("button",{onClick:()=>P("/games"),className:"inline-flex items-center justify-center gap-2 text-white/30 hover:text-white transition-all font-black uppercase tracking-[0.3em] text-[10px] group relative z-20 pointer-events-auto",children:[e.jsx(C,{size:14,className:"group-hover:-translate-x-1 transition-transform"}),"Back to Games"]})]})]})},"finished")]})})}const ae=J.memo(({card:t,onClick:l})=>{let a="bg-white/10 border-white/20 text-white active:bg-white/15 active:border-sky/40",m="";return t.isMatched?a="bg-accent/30 border-accent/50 text-white/50 cursor-default opacity-50":t.isCorrect?(a="bg-emerald-500/40 border-emerald-400 text-white",m="animate-correct-pop"):t.isWrong?(a="bg-red-500/30 border-red-400 text-white",m="animate-shake"):t.isSelected&&(a="bg-sky/25 border-sky text-white"),e.jsxs("button",{onClick:l,disabled:t.isMatched||t.isCorrect,className:`h-full min-h-[80px] md:min-h-[100px] rounded-xl p-3 md:p-4 flex flex-col items-center justify-center text-center transition-all duration-200 border-2 ${a} ${m}`,style:{WebkitTapHighlightColor:"transparent"},children:[e.jsx("div",{className:`mb-2 transition-all duration-200 ${t.type==="country"?"":t.isMatched?"opacity-50":"opacity-60"}`,children:t.type==="country"?e.jsx("img",{src:`https://flagcdn.com/w80/${t.flagCode}.png`,alt:"Flag",className:"w-10 h-auto md:w-12 select-none object-contain",loading:"lazy"}):e.jsx(te,{size:20,className:`md:w-6 md:h-6 ${t.isMatched?"text-white/60":"text-sky-light"}`})}),e.jsx("span",{className:"font-bold leading-tight text-[10px] md:text-xs uppercase tracking-tight line-clamp-2",children:t.label})]})});export{he as default};
