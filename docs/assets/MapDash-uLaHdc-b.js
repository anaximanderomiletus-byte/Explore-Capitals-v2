import{j as e,A as de,m as S}from"./vendor-motion-CUvbj6jv.js";import{r as t,d as ue,L as xe}from"./vendor-react-CJteECPR.js";import{a as pe,u as fe,M as T,S as he,B as ee}from"./index-D0wlb4ff.js";import{F as be}from"./FeedbackOverlay-CynBASEN.js";import{v as R,c as te,w as ge,s as we,r as ke,M as ve,P as ye}from"./vendor-icons-DnoOvNGG.js";import"./vendor-firebase-BmNGKg-n.js";const re=a=>a?Array.from(a).map(h=>String.fromCharCode(h.codePointAt(0)-127397).toLowerCase()).join(""):"";function Te(){const[a,h]=t.useState("start"),[g,w]=t.useState(0),[u,L]=t.useState(60),[m,se]=t.useState(null),[y,I]=t.useState(!1),[l,b]=t.useState(null),[M,k]=t.useState(null),[P,$]=t.useState([]),[D,F]=t.useState([]),[A,O]=t.useState(!1),[B,G]=t.useState(0),{recordGameResult:U}=pe(),Z=ue(),{setPageLoading:_,setHideFooter:j}=fe();t.useEffect(()=>(_(!1),j(!0),document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",()=>{j(!1),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height=""}),[_,j]);const v=t.useRef(null),n=t.useRef(null),K=t.useRef(null),N=t.useRef(new Map),c=t.useRef(null),X=t.useRef(a),H=t.useRef(m),Y=t.useRef(y),ae=t.useRef(l);t.useEffect(()=>{X.current=a},[a]),t.useEffect(()=>{H.current=m},[m]),t.useEffect(()=>{Y.current=y},[y]),t.useEffect(()=>{ae.current=l},[l]),t.useEffect(()=>{let r;return a==="playing"&&u>0?r=setInterval(()=>{L(i=>i<=1?(h("finished"),0):i-1)},1e3):u===0&&h("finished"),()=>clearInterval(r)},[a,u]);const ne=r=>{const i=Math.floor(r/60),o=r%60;return`${i}:${String(o).padStart(2,"0")}`},z=t.useCallback(()=>{N.current.forEach(r=>{const i=r.getElement();i&&i.classList.remove("marker-correct","marker-incorrect")})},[]),C=t.useCallback(()=>{const r=T[Math.floor(Math.random()*T.length)];se(r),b(null),k(null),c.current&&(clearTimeout(c.current),c.current=null),z()},[z]),J=()=>{w(0),L(60),$([]),F([]),O(!1),b(null),G(0),C(),h("playing"),n.current&&(n.current.invalidateSize(),n.current.flyTo([20,0],2.5,{duration:1.5}))},oe=()=>{n.current&&n.current.zoomIn()},ie=()=>{n.current&&n.current.zoomOut()};return t.useEffect(()=>{const r=window.L;if(!r||!v.current||n.current){if(!r&&v.current&&!n.current){const o=setTimeout(()=>{w(E=>E)},500);return()=>clearTimeout(o)}return}const i=r.map(v.current,{center:[20,0],zoom:2.5,zoomControl:!1,attributionControl:!1,minZoom:2,maxZoom:18,worldCopyJump:!0,maxBounds:[[-85,-5e3],[85,5e3]],maxBoundsViscosity:1,preferCanvas:!1});return r.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:20}).addTo(i),K.current=r.layerGroup().addTo(i),n.current=i,T.forEach(o=>{const E=r.divIcon({className:"custom-map-marker",html:'<div class="marker-pin"></div>',iconSize:[20,20],iconAnchor:[10,10]}),p=r.marker([o.lat,o.lng],{icon:E});N.current.set(o.id,p);let V=0;const le=300,W=(s,d="click")=>{const q=Date.now();if(q-V<le)return;V=q,s&&(s.originalEvent&&(s.originalEvent.stopPropagation(),s.originalEvent.stopImmediatePropagation?.(),s.originalEvent.preventDefault()),typeof r.DomEvent?.stop=="function"&&r.DomEvent.stop(s));const Q=H.current;if(X.current!=="playing"||!Q||Y.current)return;c.current&&(clearTimeout(c.current),c.current=null),z();const f=p.getElement(),ce=o.id===Q.id,me=performance.now();G(me),ce?(b("correct"),k(null),w(x=>x+50),$(x=>[...x,o.id]),I(!0),f&&f.classList.add("marker-correct"),c.current=setTimeout(()=>{C(),I(!1),c.current=null},700)):(b("incorrect"),k({name:o.name,flagCode:re(o.flag)}),w(x=>Math.max(0,x-10)),F(x=>[...x,o.id]),f&&f.classList.add("marker-incorrect"),c.current=setTimeout(()=>{f&&f.classList.remove("marker-incorrect"),b(null),k(null),c.current=null},1e3))};p.on("click",s=>W(s,"click")),p.on("add",()=>{const s=p.getElement?.();s&&!s._touchOptimized&&(s._touchOptimized=!0,s.style.touchAction="manipulation",s.style.webkitTouchCallout="none",s.style.webkitUserSelect="none",s.style.cursor="pointer",s.addEventListener("touchend",d=>{d.changedTouches.length===1&&(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation(),W({originalEvent:d},"touch"))},{passive:!1,capture:!0}),s.addEventListener("click",d=>{d.stopPropagation()},{capture:!0}))}),p.addTo(K.current)}),()=>{n.current&&(n.current.remove(),n.current=null),N.current.clear()}},[C]),t.useEffect(()=>{a==="finished"&&!A&&(U({gameId:"map-dash",score:g,correctCountries:P,incorrectCountries:D,durationSeconds:60}),O(!0))},[a,A,U,g,P,D]),e.jsxs("div",{className:"relative h-[100dvh] min-h-screen w-full z-40 bg-surface-dark overflow-hidden font-sans",children:[e.jsx(he,{title:"Map Dash",description:"Locate the nation on the map."}),e.jsx("style",{children:`
        .marker-pin { transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.2s ease, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s ease !important; }
        
        .marker-correct .marker-pin { 
          background-color: #34C759 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.5);
          box-shadow: 0 0 20px rgba(52, 199, 89, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
        }

        .marker-incorrect .marker-pin { 
          background-color: #FF3B30 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.2);
          box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
          animation: marker-shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes marker-shake {
          10%, 90% { transform: scale(1.2) translate3d(-1px, 0, 0); }
          20%, 80% { transform: scale(1.2) translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: scale(1.2) translate3d(-4px, 0, 0); }
          40%, 60% { transform: scale(1.2) translate3d(4px, 0, 0); }
        }

        @keyframes card-shake {
          10%, 90% { transform: translateX(-1%) translate(-50%, 0); }
          20%, 80% { transform: translateX(1%) translate(-50%, 0); }
          30%, 50%, 70% { transform: translateX(-2%) translate(-50%, 0); }
          40%, 60% { transform: translateX(2%) translate(-50%, 0); }
        }

        .card-shake {
          animation: card-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
      `}),e.jsx("div",{ref:v,className:"absolute inset-0 z-0 focus:outline-none bg-surface-dark"}),e.jsxs(de,{mode:"wait",children:[a==="playing"&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 left-3 sm:left-4 md:left-6 z-30 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:e.jsx(xe,{to:"/games",children:e.jsx("button",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white/80 hover:text-white transition-all border border-white/20 group active:scale-95",children:e.jsx(R,{size:18,className:"sm:w-5 sm:h-5"})})})}),e.jsxs("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 right-3 sm:right-4 md:right-6 z-30 flex gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:[e.jsxs("div",{className:"bg-surface-dark/90 backdrop-blur-xl rounded-xl border border-white/20 h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(te,{size:14,className:"sm:w-4 sm:h-4 text-warning flex-shrink-0"}),e.jsx("span",{className:"font-display font-black text-xs sm:text-sm md:text-base text-white tabular-nums relative z-10 drop-shadow-md",children:g})]}),e.jsxs("div",{className:`rounded-xl shadow-inner h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2 transition-all duration-300 relative ${u<=10?"bg-white border-2 border-error animate-timer-panic":"bg-surface-dark/90 backdrop-blur-xl border border-white/20"}`,children:[e.jsx(ge,{size:14,className:`sm:w-4 sm:h-4 relative z-10 flex-shrink-0 ${u<=10?"text-error":"text-sky"}`}),e.jsx("span",{className:`font-display font-black text-xs sm:text-sm md:text-base tabular-nums min-w-[32px] sm:min-w-[36px] relative z-10 drop-shadow-md ${u<=10?"text-error":"text-white"}`,children:ne(u)})]})]}),e.jsxs("div",{className:"absolute bottom-32 sm:bottom-36 md:bottom-40 right-3 sm:right-4 md:right-6 z-30 hidden lg:flex flex-col gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("button",{onClick:oe,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(we,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})}),e.jsx("button",{onClick:ie,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(ke,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})})]}),m&&e.jsx("div",{className:`absolute bottom-4 sm:bottom-5 md:bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-24px)] max-w-[320px] sm:max-w-[360px] md:max-w-sm z-20 pointer-events-none transform transition-all duration-500 opacity-100 translate-y-0 ${l==="incorrect"?"card-shake":""}`,children:e.jsxs("div",{className:`pointer-events-auto backdrop-blur-2xl rounded-2xl sm:rounded-[1.5rem] md:rounded-[2rem] py-8 px-5 sm:py-10 sm:px-6 md:py-10 md:px-6 lg:py-6 text-center relative transition-all duration-200 overflow-hidden
                    ${l==="correct"?"bg-accent border-2 sm:border-[3px] md:border-4 border-white":l==="incorrect"?"bg-error border-2 sm:border-[3px] md:border-4 border-white":"bg-surface-dark/95 border-2 sm:border-[3px] md:border-4 border-white/40"}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 sm:gap-2.5 md:gap-1.5 relative z-10",children:[e.jsx("p",{className:`text-[10px] sm:text-xs md:text-[10px] font-black uppercase tracking-[0.3em] sm:tracking-[0.4em] ${l?"text-white drop-shadow-md":"text-sky"}`,children:"FIND COUNTRY"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2.5 sm:gap-3 md:gap-3",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-2xl font-display font-black text-white leading-tight tracking-tighter uppercase drop-shadow-2xl line-clamp-1",children:m.name}),e.jsxs("div",{className:"w-14 h-10 sm:w-16 sm:h-11 md:w-12 md:h-8 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 blur-xl rounded-full scale-150 opacity-50"}),e.jsx("img",{src:`https://flagcdn.com/w80/${re(m.flag)}.png`,alt:`${m.name} Flag`,className:"w-full h-full object-contain filter drop-shadow-2xl relative z-10 brightness-[1.05]"})]})]})]})]})},`${m.id}-${B}`)]},"playing"),a==="start"&&e.jsx(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/40 backdrop-blur-xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-sky/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-sky border border-white/30",children:e.jsx(ve,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-display font-black text-white mb-1.5 sm:mb-2 uppercase tracking-tighter drop-shadow-md",children:"Map Dash"}),e.jsx("p",{className:"text-white/60 text-[9px] sm:text-[10px] mb-6 sm:mb-8 md:mb-10 font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] leading-relaxed",children:"Find the nations on the map."}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsxs(ee,{onClick:J,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:["PLAY ",e.jsx(ye,{size:18,className:"sm:w-5 sm:h-5",fill:"currentColor"})]}),e.jsxs("button",{onClick:()=>Z("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(R,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"start"),a==="finished"&&e.jsx(S.div,{initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/60 backdrop-blur-2xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-7 md:p-10 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-warning/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-warning border border-white/30",children:e.jsx(te,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-[1.75rem] md:text-3xl font-display font-black text-white mb-1 uppercase tracking-tighter drop-shadow-md",children:"Finished"}),e.jsx("p",{className:"text-white/60 mb-4 sm:mb-5 md:mb-6 text-[9px] sm:text-[10px] font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] drop-shadow-sm",children:"Final Score"}),e.jsx("div",{className:"text-5xl sm:text-6xl md:text-7xl font-display font-black text-white mb-6 sm:mb-8 md:mb-10 tabular-nums",children:g}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsx(ee,{onClick:J,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:"Play Again"}),e.jsxs("button",{onClick:()=>Z("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(R,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"finished")]}),e.jsx(be,{type:l,triggerKey:B,subText:l==="incorrect"&&M?.name||void 0,incorrectFlagCode:l==="incorrect"&&M?.flagCode||void 0})]})}export{Te as default};
