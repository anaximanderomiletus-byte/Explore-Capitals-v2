import{j as e,A as ce,m as M}from"./vendor-motion-CUvbj6jv.js";import{r as t,d as me,L as de}from"./vendor-react-CJteECPR.js";import{a as ue,u as xe,M as I,S as pe,B as te}from"./index-BIlN1zql.js";import{F as fe}from"./FeedbackOverlay-CynBASEN.js";import{v as P,c as se,w as he,s as be,r as ge,M as we,P as ke}from"./vendor-icons-DnoOvNGG.js";import"./vendor-firebase-BmNGKg-n.js";const re=n=>n?Array.from(n).map(b=>String.fromCharCode(b.codePointAt(0)-127397).toLowerCase()).join(""):"";function Se(){const[n,b]=t.useState("start"),[k,v]=t.useState(0),[p,$]=t.useState(60),[x,ae]=t.useState(null),[z,F]=t.useState(!1),[m,g]=t.useState(null),[D,y]=t.useState(null),[A,B]=t.useState([]),[X,O]=t.useState([]),[Y,G]=t.useState(!1),[Z,K]=t.useState(0),{recordGameResult:_}=ue(),H=me(),{setPageLoading:U,setHideFooter:C}=xe();t.useEffect(()=>(U(!1),C(!0),document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",()=>{C(!1),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height=""}),[U,C]);const j=t.useRef(null),o=t.useRef(null),q=t.useRef(null),S=t.useRef(new Map),d=t.useRef(null),J=t.useRef(n),V=t.useRef(x),W=t.useRef(z),ne=t.useRef(m);t.useEffect(()=>{J.current=n},[n]),t.useEffect(()=>{V.current=x},[x]),t.useEffect(()=>{W.current=z},[z]),t.useEffect(()=>{ne.current=m},[m]),t.useEffect(()=>{let s;return n==="playing"&&p>0?s=setInterval(()=>{$(l=>l<=1?(b("finished"),0):l-1)},1e3):p===0&&b("finished"),()=>clearInterval(s)},[n,p]);const oe=s=>{const l=Math.floor(s/60),i=s%60;return`${l}:${String(i).padStart(2,"0")}`},T=t.useCallback(()=>{S.current.forEach(s=>{const l=s.getElement();l&&l.classList.remove("marker-correct","marker-incorrect")})},[]),E=t.useCallback(()=>{const s=I[Math.floor(Math.random()*I.length)];ae(s),g(null),y(null),d.current&&(clearTimeout(d.current),d.current=null),T()},[T]),Q=()=>{v(0),$(60),B([]),O([]),G(!1),g(null),K(0),E(),b("playing"),o.current&&(o.current.invalidateSize(),o.current.flyTo([20,0],2.5,{duration:1.5}))},ie=()=>{o.current&&o.current.zoomIn()},le=()=>{o.current&&o.current.zoomOut()};return t.useEffect(()=>{const s=window.L;if(!s||!j.current||o.current){if(!s&&j.current&&!o.current){const i=setTimeout(()=>{v(R=>R)},500);return()=>clearTimeout(i)}return}const l=s.map(j.current,{center:[20,0],zoom:2.5,zoomControl:!1,attributionControl:!1,minZoom:2,maxZoom:18,worldCopyJump:!0,maxBounds:[[-85,-5e3],[85,5e3]],maxBoundsViscosity:1,preferCanvas:!1});return s.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:20}).addTo(l),q.current=s.layerGroup().addTo(l),o.current=l,I.forEach(i=>{const R=s.divIcon({className:"custom-map-marker",html:'<div class="marker-pin"></div>',iconSize:[20,20],iconAnchor:[10,10]}),h=s.marker([i.lat,i.lng],{icon:R});S.current.set(i.id,h);let N={current:!1};const ee=(a,c=!1)=>{if(!c&&N.current){N.current=!1;return}a&&a.originalEvent&&(a.originalEvent.stopPropagation(),a.originalEvent.preventDefault()),a&&typeof s.DomEvent?.stopPropagation=="function"&&s.DomEvent.stopPropagation(a);const r=V.current;if(J.current!=="playing"||!r||W.current)return;d.current&&(clearTimeout(d.current),d.current=null),T();const u=h.getElement(),w=i.id===r.id,L=performance.now();K(L),w?(g("correct"),y(null),v(f=>f+50),B(f=>[...f,i.id]),F(!0),u&&u.classList.add("marker-correct"),d.current=setTimeout(()=>{E(),F(!1),d.current=null},700)):(g("incorrect"),y({name:i.name,flagCode:re(i.flag)}),v(f=>Math.max(0,f-10)),O(f=>[...f,i.id]),u&&u.classList.add("marker-incorrect"),d.current=setTimeout(()=>{u&&u.classList.remove("marker-incorrect"),g(null),y(null),d.current=null},1e3))};h.on("click",a=>ee(a,!1)),h.on("add",()=>{const a=h.getElement?.();if(a&&!a._touchBound){a._touchBound=!0;let c=null;a.addEventListener("touchstart",r=>{r.touches.length===1&&(c={x:r.touches[0].clientX,y:r.touches[0].clientY},N.current=!0)},{passive:!0}),a.addEventListener("touchend",r=>{if(setTimeout(()=>{N.current=!1},600),c&&r.changedTouches.length===1){const u=r.changedTouches[0].clientX,w=r.changedTouches[0].clientY;Math.sqrt(Math.pow(u-c.x,2)+Math.pow(w-c.y,2))<10&&(r.preventDefault(),r.stopPropagation(),ee({originalEvent:r},!0))}c=null},{passive:!1}),a.addEventListener("touchmove",r=>{if(c&&r.touches.length===1){const u=r.touches[0].clientX,w=r.touches[0].clientY;Math.sqrt(Math.pow(u-c.x,2)+Math.pow(w-c.y,2))>10&&(c=null)}},{passive:!0})}}),h.addTo(q.current)}),()=>{o.current&&(o.current.remove(),o.current=null),S.current.clear()}},[E]),t.useEffect(()=>{n==="finished"&&!Y&&(_({gameId:"map-dash",score:k,correctCountries:A,incorrectCountries:X,durationSeconds:60}),G(!0))},[n,Y,_,k,A,X]),e.jsxs("div",{className:"relative h-[100dvh] min-h-screen w-full z-40 bg-surface-dark overflow-hidden font-sans",children:[e.jsx(pe,{title:"Map Dash",description:"Locate the nation on the map."}),e.jsx("style",{children:`
        .marker-pin { transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.2s ease, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s ease !important; }
        
        .marker-correct .marker-pin { 
          background-color: #34C759 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.5);
          box-shadow: 0 0 20px rgba(52, 199, 89, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
        }

        .marker-incorrect .marker-pin { 
          background-color: #FF3B30 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.2);
          box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
          animation: marker-shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes marker-shake {
          10%, 90% { transform: scale(1.2) translate3d(-1px, 0, 0); }
          20%, 80% { transform: scale(1.2) translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: scale(1.2) translate3d(-4px, 0, 0); }
          40%, 60% { transform: scale(1.2) translate3d(4px, 0, 0); }
        }

        @keyframes card-shake {
          10%, 90% { transform: translateX(-1%) translate(-50%, 0); }
          20%, 80% { transform: translateX(1%) translate(-50%, 0); }
          30%, 50%, 70% { transform: translateX(-2%) translate(-50%, 0); }
          40%, 60% { transform: translateX(2%) translate(-50%, 0); }
        }

        .card-shake {
          animation: card-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
      `}),e.jsx("div",{ref:j,className:"absolute inset-0 z-0 focus:outline-none bg-surface-dark"}),e.jsxs(ce,{mode:"wait",children:[n==="playing"&&e.jsxs(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 left-3 sm:left-4 md:left-6 z-30 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:e.jsx(de,{to:"/games",children:e.jsx("button",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white/80 hover:text-white transition-all border border-white/20 group active:scale-95",children:e.jsx(P,{size:18,className:"sm:w-5 sm:h-5"})})})}),e.jsxs("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 right-3 sm:right-4 md:right-6 z-30 flex gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:[e.jsxs("div",{className:"bg-surface-dark/90 backdrop-blur-xl rounded-xl border border-white/20 h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(se,{size:14,className:"sm:w-4 sm:h-4 text-warning flex-shrink-0"}),e.jsx("span",{className:"font-display font-black text-xs sm:text-sm md:text-base text-white tabular-nums relative z-10 drop-shadow-md",children:k})]}),e.jsxs("div",{className:`rounded-xl shadow-inner h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2 transition-all duration-300 relative ${p<=10?"bg-white border-2 border-error animate-timer-panic":"bg-surface-dark/90 backdrop-blur-xl border border-white/20"}`,children:[e.jsx(he,{size:14,className:`sm:w-4 sm:h-4 relative z-10 flex-shrink-0 ${p<=10?"text-error":"text-sky"}`}),e.jsx("span",{className:`font-display font-black text-xs sm:text-sm md:text-base tabular-nums min-w-[32px] sm:min-w-[36px] relative z-10 drop-shadow-md ${p<=10?"text-error":"text-white"}`,children:oe(p)})]})]}),e.jsxs("div",{className:"absolute bottom-32 sm:bottom-36 md:bottom-40 right-3 sm:right-4 md:right-6 z-30 hidden lg:flex flex-col gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("button",{onClick:ie,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(be,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})}),e.jsx("button",{onClick:le,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(ge,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})})]}),x&&e.jsx("div",{className:`absolute bottom-4 sm:bottom-5 md:bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-24px)] max-w-[320px] sm:max-w-[360px] md:max-w-sm z-20 pointer-events-none transform transition-all duration-500 opacity-100 translate-y-0 ${m==="incorrect"?"card-shake":""}`,children:e.jsxs("div",{className:`pointer-events-auto backdrop-blur-2xl rounded-2xl sm:rounded-[1.5rem] md:rounded-[2rem] py-8 px-5 sm:py-10 sm:px-6 md:py-10 md:px-6 lg:py-6 text-center relative transition-all duration-200 overflow-hidden
                    ${m==="correct"?"bg-accent border-2 sm:border-[3px] md:border-4 border-white":m==="incorrect"?"bg-error border-2 sm:border-[3px] md:border-4 border-white":"bg-surface-dark/95 border-2 sm:border-[3px] md:border-4 border-white/40"}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 sm:gap-2.5 md:gap-1.5 relative z-10",children:[e.jsx("p",{className:`text-[10px] sm:text-xs md:text-[10px] font-black uppercase tracking-[0.3em] sm:tracking-[0.4em] ${m?"text-white drop-shadow-md":"text-sky"}`,children:"FIND COUNTRY"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2.5 sm:gap-3 md:gap-3",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-2xl font-display font-black text-white leading-tight tracking-tighter uppercase drop-shadow-2xl line-clamp-1",children:x.name}),e.jsxs("div",{className:"w-14 h-10 sm:w-16 sm:h-11 md:w-12 md:h-8 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 blur-xl rounded-full scale-150 opacity-50"}),e.jsx("img",{src:`https://flagcdn.com/w80/${re(x.flag)}.png`,alt:`${x.name} Flag`,className:"w-full h-full object-contain filter drop-shadow-2xl relative z-10 brightness-[1.05]"})]})]})]})]})},`${x.id}-${Z}`)]},"playing"),n==="start"&&e.jsx(M.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/40 backdrop-blur-xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-sky/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-sky border border-white/30",children:e.jsx(we,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-display font-black text-white mb-1.5 sm:mb-2 uppercase tracking-tighter drop-shadow-md",children:"Map Dash"}),e.jsx("p",{className:"text-white/60 text-[9px] sm:text-[10px] mb-6 sm:mb-8 md:mb-10 font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] leading-relaxed",children:"Find the nations on the map."}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsxs(te,{onClick:Q,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:["PLAY ",e.jsx(ke,{size:18,className:"sm:w-5 sm:h-5",fill:"currentColor"})]}),e.jsxs("button",{onClick:()=>H("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(P,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"start"),n==="finished"&&e.jsx(M.div,{initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/60 backdrop-blur-2xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-7 md:p-10 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-warning/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-warning border border-white/30",children:e.jsx(se,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-[1.75rem] md:text-3xl font-display font-black text-white mb-1 uppercase tracking-tighter drop-shadow-md",children:"Finished"}),e.jsx("p",{className:"text-white/60 mb-4 sm:mb-5 md:mb-6 text-[9px] sm:text-[10px] font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] drop-shadow-sm",children:"Final Score"}),e.jsx("div",{className:"text-5xl sm:text-6xl md:text-7xl font-display font-black text-white mb-6 sm:mb-8 md:mb-10 tabular-nums",children:k}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsx(te,{onClick:Q,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:"Play Again"}),e.jsxs("button",{onClick:()=>H("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(P,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"finished")]}),e.jsx(fe,{type:m,triggerKey:Z,subText:m==="incorrect"&&D?.name||void 0,incorrectFlagCode:m==="incorrect"&&D?.flagCode||void 0})]})}export{Se as default};
