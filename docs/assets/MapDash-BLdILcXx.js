import{r as t,i as oe,a as ie,u as le,M as R,j as e,S as me,k as ce,m as T,L as de,l as J,e as ue,B as V}from"./index-DUyATDXp.js";import{F as xe}from"./FeedbackOverlay-De99bfjV.js";import{A as S}from"./arrow-left-BRmuxxaS.js";import{T as pe}from"./timer-Cmefgo2J.js";import{P as fe,M as he}from"./plus-IkE5ADcR.js";import{P as be}from"./play-BmPO66zq.js";import"./sparkles-UGMlKg4r.js";import"./circle-check-s3Dv0z9Q.js";import"./circle-x-B53tg75K.js";const W=s=>s?Array.from(s).map(p=>String.fromCharCode(p.codePointAt(0)-127397).toLowerCase()).join(""):"";function Re(){const[s,p]=t.useState("start"),[h,b]=t.useState(0),[c,L]=t.useState(60),[m,q]=t.useState(null),[v,E]=t.useState(!1),[i,f]=t.useState(null),[u,g]=t.useState(null),[M,I]=t.useState([]),[$,F]=t.useState([]),[P,A]=t.useState(!1),[B,O]=t.useState(0),{recordGameResult:G}=oe(),Z=ie(),{setPageLoading:K,setHideFooter:y}=le();t.useEffect(()=>(K(!1),y(!0),document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.height="100%",()=>{y(!1),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height=""}),[K,y]);const w=t.useRef(null),a=t.useRef(null),X=t.useRef(null),j=t.useRef(new Map),l=t.useRef(null),D=t.useRef(s),U=t.useRef(m),H=t.useRef(v),Q=t.useRef(i);t.useEffect(()=>{D.current=s},[s]),t.useEffect(()=>{U.current=m},[m]),t.useEffect(()=>{H.current=v},[v]),t.useEffect(()=>{Q.current=i},[i]),t.useEffect(()=>{let r;return s==="playing"&&c>0?r=setInterval(()=>{L(o=>o<=1?(p("finished"),0):o-1)},1e3):c===0&&p("finished"),()=>clearInterval(r)},[s,c]);const ee=r=>{const o=Math.floor(r/60),n=r%60;return`${o}:${String(n).padStart(2,"0")}`},N=t.useCallback(()=>{j.current.forEach(r=>{const o=r.getElement();o&&o.classList.remove("marker-correct","marker-incorrect")})},[]),z=t.useCallback(()=>{const r=R[Math.floor(Math.random()*R.length)];q(r),f(null),g(null),l.current&&(clearTimeout(l.current),l.current=null),N()},[N]),Y=()=>{b(0),L(60),I([]),F([]),A(!1),f(null),O(0),z(),p("playing"),a.current&&(a.current.invalidateSize(),a.current.flyTo([20,0],2.5,{duration:1.5}))},te=()=>{a.current&&a.current.zoomIn()},re=()=>{a.current&&a.current.zoomOut()};return t.useEffect(()=>{const r=window.L;if(!r||!w.current||a.current){if(!r&&w.current&&!a.current){const n=setTimeout(()=>{b(C=>C)},500);return()=>clearTimeout(n)}return}const o=r.map(w.current,{center:[20,0],zoom:2.5,zoomControl:!1,attributionControl:!1,minZoom:2,maxZoom:18,worldCopyJump:!0,maxBounds:[[-85,-5e3],[85,5e3]],maxBoundsViscosity:1,preferCanvas:!1});return r.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:20}).addTo(o),X.current=r.layerGroup().addTo(o),a.current=o,R.forEach(n=>{const C=r.divIcon({className:"custom-map-marker",html:'<div class="marker-pin"></div>',iconSize:[20,20],iconAnchor:[10,10]}),k=r.marker([n.lat,n.lng],{icon:C});j.current.set(n.id,k),k.on("click",se=>{r.DomEvent.stopPropagation(se);const _=U.current;if(D.current!=="playing"||!_||H.current)return;l.current&&(clearTimeout(l.current),l.current=null),N();const x=k.getElement(),ae=n.id===_.id,ne=performance.now();O(ne),ae?(f("correct"),g(null),b(d=>d+50),I(d=>[...d,n.id]),E(!0),x&&x.classList.add("marker-correct"),l.current=setTimeout(()=>{z(),E(!1),l.current=null},700)):(f("incorrect"),g({name:n.name,flagCode:W(n.flag)}),b(d=>Math.max(0,d-10)),F(d=>[...d,n.id]),x&&x.classList.add("marker-incorrect"),l.current=setTimeout(()=>{x&&x.classList.remove("marker-incorrect"),f(null),g(null),l.current=null},1e3))}),k.addTo(X.current)}),()=>{a.current&&(a.current.remove(),a.current=null),j.current.clear()}},[z]),t.useEffect(()=>{s==="finished"&&!P&&(G({gameId:"map-dash",score:h,correctCountries:M,incorrectCountries:$,durationSeconds:60}),A(!0))},[s,P,G,h,M,$]),e.jsxs("div",{className:"relative h-[100dvh] min-h-screen w-full z-40 bg-surface-dark overflow-hidden font-sans",children:[e.jsx(me,{title:"Map Dash",description:"Locate the nation on the map."}),e.jsx("style",{children:`
        .marker-pin { transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.2s ease, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s ease !important; }
        
        .marker-correct .marker-pin { 
          background-color: #34C759 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.5);
          box-shadow: 0 0 20px rgba(52, 199, 89, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
        }

        .marker-incorrect .marker-pin { 
          background-color: #FF3B30 !important; 
          border: 2px solid rgba(255,255,255,0.8) !important; 
          transform: scale(1.2);
          box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 4px 12px rgba(0,0,0,0.3) !important;
          animation: marker-shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes marker-shake {
          10%, 90% { transform: scale(1.2) translate3d(-1px, 0, 0); }
          20%, 80% { transform: scale(1.2) translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: scale(1.2) translate3d(-4px, 0, 0); }
          40%, 60% { transform: scale(1.2) translate3d(4px, 0, 0); }
        }

        @keyframes card-shake {
          10%, 90% { transform: translateX(-1%) translate(-50%, 0); }
          20%, 80% { transform: translateX(1%) translate(-50%, 0); }
          30%, 50%, 70% { transform: translateX(-2%) translate(-50%, 0); }
          40%, 60% { transform: translateX(2%) translate(-50%, 0); }
        }

        .card-shake {
          animation: card-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
      `}),e.jsx("div",{ref:w,className:"absolute inset-0 z-0 focus:outline-none bg-surface-dark"}),e.jsxs(ce,{mode:"wait",children:[s==="playing"&&e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 left-3 sm:left-4 md:left-6 z-30 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:e.jsx(de,{to:"/games",children:e.jsx("button",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white/80 hover:text-white transition-all border border-white/20 group active:scale-95",children:e.jsx(S,{size:18,className:"sm:w-5 sm:h-5"})})})}),e.jsxs("div",{className:"absolute top-[4.5rem] sm:top-20 md:top-24 right-3 sm:right-4 md:right-6 z-30 flex gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-top-4 duration-500",children:[e.jsxs("div",{className:"bg-surface-dark/90 backdrop-blur-xl rounded-xl border border-white/20 h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(J,{size:14,className:"sm:w-4 sm:h-4 text-warning flex-shrink-0"}),e.jsx("span",{className:"font-display font-black text-xs sm:text-sm md:text-base text-white tabular-nums relative z-10 drop-shadow-md",children:h})]}),e.jsxs("div",{className:`rounded-xl shadow-inner h-9 sm:h-10 px-2.5 sm:px-3 md:px-4 flex items-center gap-1.5 sm:gap-2 transition-all duration-300 relative ${c<=10?"bg-white border-2 border-error animate-timer-panic":"bg-surface-dark/90 backdrop-blur-xl border border-white/20"}`,children:[e.jsx(pe,{size:14,className:`sm:w-4 sm:h-4 relative z-10 flex-shrink-0 ${c<=10?"text-error":"text-sky"}`}),e.jsx("span",{className:`font-display font-black text-xs sm:text-sm md:text-base tabular-nums min-w-[32px] sm:min-w-[36px] relative z-10 drop-shadow-md ${c<=10?"text-error":"text-white"}`,children:ee(c)})]})]}),e.jsxs("div",{className:"absolute bottom-32 sm:bottom-36 md:bottom-40 right-3 sm:right-4 md:right-6 z-30 hidden lg:flex flex-col gap-1.5 sm:gap-2 pointer-events-auto animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsx("button",{onClick:te,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(fe,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})}),e.jsx("button",{onClick:re,className:"w-9 h-9 sm:w-10 sm:h-10 bg-surface-dark/90 backdrop-blur-xl hover:bg-surface-dark rounded-xl flex items-center justify-center text-white transition-all border border-white/20 relative overflow-hidden group active:scale-95",children:e.jsx(he,{size:18,className:"sm:w-5 sm:h-5 relative z-10"})})]}),m&&e.jsx("div",{className:`absolute bottom-4 sm:bottom-5 md:bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-24px)] max-w-[320px] sm:max-w-[360px] md:max-w-sm z-20 pointer-events-none transform transition-all duration-500 opacity-100 translate-y-0 ${i==="incorrect"?"card-shake":""}`,children:e.jsxs("div",{className:`pointer-events-auto backdrop-blur-2xl rounded-2xl sm:rounded-[1.5rem] md:rounded-[2rem] py-8 px-5 sm:py-10 sm:px-6 md:py-10 md:px-6 lg:py-6 text-center relative transition-all duration-200 overflow-hidden
                    ${i==="correct"?"bg-accent border-2 sm:border-[3px] md:border-4 border-white":i==="incorrect"?"bg-error border-2 sm:border-[3px] md:border-4 border-white":"bg-surface-dark/95 border-2 sm:border-[3px] md:border-4 border-white/40"}`,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 sm:gap-2.5 md:gap-1.5 relative z-10",children:[e.jsx("p",{className:`text-[10px] sm:text-xs md:text-[10px] font-black uppercase tracking-[0.3em] sm:tracking-[0.4em] ${i?"text-white drop-shadow-md":"text-sky"}`,children:"FIND COUNTRY"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2.5 sm:gap-3 md:gap-3",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-2xl font-display font-black text-white leading-tight tracking-tighter uppercase drop-shadow-2xl line-clamp-1",children:m.name}),e.jsxs("div",{className:"w-14 h-10 sm:w-16 sm:h-11 md:w-12 md:h-8 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 blur-xl rounded-full scale-150 opacity-50"}),e.jsx("img",{src:`https://flagcdn.com/w80/${W(m.flag)}.png`,alt:`${m.name} Flag`,className:"w-full h-full object-contain filter drop-shadow-2xl relative z-10 brightness-[1.05]"})]})]})]})]})},`${m.id}-${B}`)]},"playing"),s==="start"&&e.jsx(T.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.1},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/40 backdrop-blur-xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-6 md:p-8 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-sky/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-sky border border-white/30",children:e.jsx(ue,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-display font-black text-white mb-1.5 sm:mb-2 uppercase tracking-tighter drop-shadow-md",children:"Map Dash"}),e.jsx("p",{className:"text-white/60 text-[9px] sm:text-[10px] mb-6 sm:mb-8 md:mb-10 font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] leading-relaxed",children:"Find the nations on the map."}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsxs(V,{onClick:Y,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:["PLAY ",e.jsx(be,{size:18,className:"sm:w-5 sm:h-5",fill:"currentColor"})]}),e.jsxs("button",{onClick:()=>Z("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(S,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"start"),s==="finished"&&e.jsx(T.div,{initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute inset-0 z-[2000] flex items-center justify-center bg-surface-dark/60 backdrop-blur-2xl p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-[calc(100%-24px)] sm:max-w-sm md:max-w-md w-full bg-surface-dark/95 backdrop-blur-3xl rounded-2xl sm:rounded-3xl p-5 sm:p-7 md:p-10 text-center border-2 border-white/20",children:[e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-warning/20 rounded-full flex items-center justify-center mx-auto mb-5 sm:mb-6 md:mb-8 text-warning border border-white/30",children:e.jsx(J,{size:28,className:"sm:w-8 sm:h-8 md:w-9 md:h-9 relative z-10"})}),e.jsx("h1",{className:"text-2xl sm:text-[1.75rem] md:text-3xl font-display font-black text-white mb-1 uppercase tracking-tighter drop-shadow-md",children:"Finished"}),e.jsx("p",{className:"text-white/60 mb-4 sm:mb-5 md:mb-6 text-[9px] sm:text-[10px] font-bold uppercase tracking-[0.15em] sm:tracking-[0.2em] drop-shadow-sm",children:"Final Score"}),e.jsx("div",{className:"text-5xl sm:text-6xl md:text-7xl font-display font-black text-white mb-6 sm:mb-8 md:mb-10 tabular-nums",children:h}),e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-5 md:gap-6",children:[e.jsx(V,{onClick:Y,size:"md",className:"w-full h-12 sm:h-14 md:h-16 text-base sm:text-lg md:text-xl uppercase tracking-wider sm:tracking-widest font-black",children:"Play Again"}),e.jsxs("button",{onClick:()=>Z("/games"),className:"inline-flex items-center justify-center gap-2 text-white/40 hover:text-white transition-all font-black uppercase tracking-[0.2em] sm:tracking-[0.3em] text-[9px] sm:text-[10px] group relative z-20 pointer-events-auto py-2",children:[e.jsx(S,{size:12,className:"sm:w-3.5 sm:h-3.5 transition-transform"}),"Back to Games"]})]})]})},"finished")]}),e.jsx(xe,{type:i,triggerKey:B,subText:i==="incorrect"&&(u==null?void 0:u.name)||void 0,incorrectFlagCode:i==="incorrect"&&(u==null?void 0:u.flagCode)||void 0})]})}export{Re as default};
